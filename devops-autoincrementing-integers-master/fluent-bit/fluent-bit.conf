[SERVICE]
    Flush        1
    Log_Level    info
    Parsers_File parsers.conf

[INPUT]
    Name        tail
    Path        /logs/*.log
    Parser      rails
    Tag         rails.*
    Mem_Buf_Limit 5MB
    Skip_Long_Lines On

[INPUT]
    Name        tail
    Path        /logs/nginx/*.log
    Parser      nginx
    Tag         nginx.*
    Mem_Buf_Limit 5MB
    Skip_Long_Lines On

[FILTER]
    Name        modify
    Match       *
    Add         hostname ${HOSTNAME}
    Add         environment production

[FILTER]
    Name        record_modifier
    Match       *
    Record      timestamp ${time}
    Record      service rails-app

[OUTPUT]
    Name        http
    Match       *
    Host        example.com
    Port        443
    URI         /logs
    Header      Content-Type application/json
    Header      Authorization Bearer your-api-key-here
    HTTP_User   fluent-bit
    HTTP_Passwd your-password-here
    tls         On
    tls.verify  Off
    Retry_Limit False
    net.keepalive On
    net.keepalive_idle_timeout 30
    net.keepalive_max_reuse 2000
